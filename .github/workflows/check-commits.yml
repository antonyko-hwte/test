name: GitLint Check

on:
  push:
    branches: [ main, master, develop ] # 검사할 주요 브랜치
  pull_request:
    branches: [ main, master, develop ]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 커밋 히스토리 전체를 가져와야 비교가 가능합니다.

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install gitlint
        run: pip install gitlint

      - name: Run gitlint (Pull Request)
        if: github.event_name == 'pull_request'
        run: |
          # PR의 경우 base 브랜치부터 현재 HEAD까지의 모든 커밋 검사
          gitlint --commits "origin/${{ github.base_ref }}..HEAD"

      - name: Run gitlint (Push)
        if: github.event_name == 'push'
        run: |
          # Push의 경우 새로 추가된 커밋들만 검사
          # 첫 커밋이거나 비교 대상이 없을 경우를 대비해 예외 처리 포함
          gitlint --commits "${{ github.event.before }}..${{ github.event.after }}" || echo "No commits to lint or new branch"
